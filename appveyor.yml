os: Ubuntu
platform:
  - x64
install:
  - sudo apt-get update && sudo apt-get install -y bridge-utils dnsmasq-base ebtables libvirt-bin libvirt-dev qemu-kvm qemu-utils ruby-dev
  - sudo wget -nv https://releases.hashicorp.com/vagrant/2.2.9/vagrant_2.2.9_x86_64.deb
  - sudo dpkg -i vagrant_2.2.9_x86_64.deb
  - sudo vagrant plugin install vagrant-libvirt vagrant-scp vagrant-reload vagrant-vbguest
build_script:
  - touch salt/roots/salt/forticlient/secrets/mycert.p12
  - echo '{"credential":{"server":"192.168.1.1","certificate":"mycert.p12","certpasswd":"abcde12345"}}' > salt/roots/pillar/credential.sls
  - cat salt/roots/pillar/credential.sls
  - sudo vagrant up --provider=libvirt
  - sudo vagrant ssh forticlient-box -- sudo salt-call state.highstate saltenv=base
  - sudo vagrant reload
  - sudo vagrant ssh forticlient-box -- sudo salt-call state.sls forticlient.host.present
  - sudo vagrant ssh forticlient-box -- sudo salt-call state.sls forticlient.podman.present
  - sudo vagrant destroy --force
test: off
